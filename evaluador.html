<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluador 9US | Cambio de Uso</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body class="bg-slate-50 text-gray-800 font-sans min-h-screen flex flex-col">

    <nav class="bg-white shadow-sm border-b p-4">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <a href="index.html" class="text-2xl font-black text-slate-800 tracking-tighter hover:text-blue-600 transition">
                9<span class="text-blue-600">US</span>
            </a>
            <span class="text-sm font-bold text-gray-400 uppercase tracking-widest hidden sm:block">Pre-evaluaci√≥n Gratuita</span>
        </div>
    </nav>

    <div class="flex-grow p-4 md:p-8 flex items-center justify-center">
        <div id="informePDF" class="w-full max-w-4xl bg-white p-6 md:p-10 rounded-2xl shadow-xl border border-gray-100">
            
            <div class="mb-8" data-html2canvas-ignore>
                <div class="flex justify-between mb-2">
                    <span id="progText1" class="text-xs font-bold text-blue-600 uppercase">1. Filtro Urban√≠stico</span>
                    <span id="progText2" class="text-xs font-bold text-gray-400 uppercase">2. Filtro T√©cnico</span>
                    <span id="progText3" class="text-xs font-bold text-gray-400 uppercase">3. Resultado</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div id="progressBar" class="bg-blue-600 h-2 rounded-full transition-all duration-500" style="width: 33%"></div>
                </div>
            </div>

            <div id="paso1" class="paso-bloque block">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-slate-800">Fase 1: Viabilidad Urban√≠stica</h2>
                    <p class="text-gray-500 text-sm">Comprobamos si el municipio y el edificio permiten el cambio de uso.</p>
                </div>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="space-y-4">
                        <label class="block text-sm font-bold text-gray-700">Municipio del inmueble:</label>
                        <select id="municipioSelect" onchange="actualizarReglasMunicipio()" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-slate-50">
                            <option value="general" selected>Resto de municipios (Catalu√±a)</option>
                            <option value="barcelona">Barcelona</option>
                            <option value="lhospitalet">L'Hospitalet de Llobregat</option>
                            <option value="terrassa">Terrassa</option>
                            <option value="sabadell">Sabadell</option>
                            <option value="mataro">Matar√≥</option>
                        </select>
                        
                        <div id="avisosMunicipio" class="space-y-2 mt-4 text-xs p-3 bg-blue-50 rounded-lg border border-blue-100 hidden">
                            <div id="avisoParking" class="text-blue-800"></div>
                            <div id="avisoHumos" class="text-blue-800 mt-2 font-medium"></div>
                        </div>
                    </div>

                    <div class="space-y-4 bg-slate-50 p-5 rounded-xl border border-gray-200">
                        <h3 class="font-bold text-slate-700">Densidad del Edificio</h3>
                        <p class="text-[10px] text-gray-500 uppercase font-bold tracking-tight">Datos necesarios del Catastro:</p>
                        <div class="grid grid-cols-2 gap-3">
                            <div><label class="text-xs font-semibold">M¬≤ Parcela:</label><input type="number" id="superficieParcela" placeholder="Ej: 500" class="w-full p-2 border rounded mt-1"></div>
                            <div><label class="text-xs font-semibold">√çndice:</label><input type="number" id="indiceDensidad" placeholder="Ej: 80" class="w-full p-2 border rounded mt-1"></div>
                        </div>
                        <div><label class="text-xs font-semibold">N¬∫ Viviendas actuales:</label><input type="number" id="viviendasExistentes" placeholder="Ej: 6" class="w-full p-2 border rounded mt-1"></div>
                        <button onclick="calcularDensidad()" class="w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-2 rounded-lg transition">Verificar Viabilidad Urban√≠stica</button>
                        <div id="resultadoDensidad" class="mt-2 text-center font-bold text-sm hidden p-2 rounded"></div>
                    </div>
                </div>

                <div class="mt-8 flex justify-end">
                    <button onclick="irPaso2()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-transform transform hover:scale-105">Siguiente Paso ‚ûî</button>
                </div>
            </div>

            <div id="paso2" class="paso-bloque hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-slate-800">Fase 2: Requisitos de Habitabilidad</h2>
                    <p class="text-gray-500 text-sm">An√°lisis de los m¬≤ disponibles y la fachada seg√∫n normativa catalana.</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm space-y-6">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label id="labelSupMinima" class="text-sm font-bold text-gray-700">Superficie √∫til del local (m¬≤):</label>
                            <input type="number" id="checkSuperficie" oninput="evaluarTecnico()" class="w-full p-3 border rounded-lg mt-1 bg-slate-50 focus:ring-2 focus:ring-blue-500">
                            <div id="resSuperficie" class="text-xs font-medium mt-1 h-4"></div>
                        </div>
                        <div>
                            <label class="text-sm font-bold text-gray-700">Longitud de fachada a calle (m):</label>
                            <input type="number" id="checkFachada" oninput="evaluarTecnico()" class="w-full p-3 border rounded-lg mt-1 bg-slate-50 focus:ring-2 focus:ring-blue-500">
                            <div id="resFachada" class="text-xs font-medium mt-1 h-4"></div>
                        </div>
                    </div>

                    <div class="pt-4 border-t border-gray-100">
                        <p class="text-xs text-gray-500 mb-4">Otros factores cr√≠ticos que revisaremos en la visita t√©cnica:</p>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="flex items-start gap-3 p-3 bg-gray-50 rounded-lg">
                                <input type="checkbox" checked disabled class="mt-1">
                                <span class="text-xs text-gray-600">Altura libre m√≠nima (2,50m en zonas nobles).</span>
                            </div>
                            <div class="flex items-start gap-3 p-3 bg-gray-50 rounded-lg">
                                <input type="checkbox" checked disabled class="mt-1">
                                <span class="text-xs text-gray-600">Salida de humos reglamentaria a cubierta.</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-8 flex justify-between">
                    <button onclick="volver(1)" class="text-gray-400 hover:text-gray-600 font-bold py-3">‚¨Ö Atr√°s</button>
                    <button onclick="irPaso3()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-transform transform hover:scale-105">Ver Resultado Final ‚ûî</button>
                </div>
            </div>

            <div id="paso3" class="paso-bloque hidden">
                <div id="resultadoExito" class="hidden">
                    <div class="text-center mb-8">
                        <div class="inline-block bg-green-100 text-green-600 p-4 rounded-full mb-4">
                            <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        </div>
                        <h2 class="text-3xl font-black text-slate-900 uppercase tracking-tight">¬°Local Apto para Estudio!</h2>
                        <p class="text-gray-600 mt-2 max-w-lg mx-auto">Tu inmueble ha superado el primer filtro. A falta de una revisi√≥n presencial, tiene el potencial para convertirse en vivienda.</p>
                    </div>

                    <div class="grid md:grid-cols-2 gap-8 items-stretch">
                        <div class="bg-slate-900 text-white p-8 rounded-2xl flex flex-col justify-center">
                            <h3 class="text-xl font-bold text-blue-400 mb-4">Pr√≥ximo paso: Visita T√©cnica</h3>
                            <ul class="space-y-3 text-sm text-gray-300">
                                <li class="flex items-start gap-2">‚úÖ Medici√≥n real de cotas y bajantes.</li>
                                <li class="flex items-start gap-2">‚úÖ An√°lisis de estatutos y salida de humos.</li>
                                <li class="flex items-start gap-2">‚úÖ <strong>Informe ROI 9US:</strong> Estudio de costes de obra, licencias y rentabilidad final.</li>
                            </ul>
                            <div class="mt-8 pt-6 border-t border-white/10">
                                <span class="block text-gray-400 text-xs uppercase mb-1">Coste del servicio</span>
                                <span class="text-3xl font-black text-white">250‚Ç¨ <small class="text-sm font-normal text-gray-400">(IVA incl.)</small></span>
                            </div>
                        </div>

                        <div class="bg-blue-50 border border-blue-200 rounded-2xl p-6 md:p-8">
                            <h3 class="text-lg font-bold text-blue-900 mb-4">Solicitar llamada para concretar visita</h3>
                            <form action="https://formspree.io/f/xjgeoblw" method="POST" class="space-y-4">
                                <input type="hidden" name="Inmueble_Viable" value="SI">
                                <input type="hidden" name="Municipio" id="hiddenMunicipio">
                                <input type="hidden" name="Superficie_Declarada" id="hiddenSup">

                                <div>
                                    <label class="text-xs font-bold text-gray-600 uppercase">Nombre:</label>
                                    <input type="text" name="name" required class="w-full p-3 border rounded-lg bg-white mt-1 text-sm">
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-gray-600 uppercase">Tel√©fono de contacto:</label>
                                    <input type="tel" name="phone" required class="w-full p-3 border rounded-lg bg-white mt-1 text-sm">
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-gray-600 uppercase">Email:</label>
                                    <input type="email" name="email" required class="w-full p-3 border rounded-lg bg-white mt-1 text-sm">
                                </div>
                                
                                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-lg shadow-lg transition-transform transform hover:-translate-y-1">
                                    Quiero concretar la visita
                                </button>
                                <p class="text-[10px] text-center text-gray-400 mt-2">Te llamaremos en menos de 24h para agendar la inspecci√≥n t√©cnica.</p>
                            </form>
                        </div>
                    </div>
                </div>

                <div id="resultadoFracaso" class="hidden text-center py-12">
                    <div class="inline-block bg-red-100 text-red-600 p-4 rounded-full mb-4">
                        <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </div>
                    <h2 class="text-2xl font-black text-slate-900 mb-2 font-uppercase">Local No Compatible</h2>
                    <p class="text-gray-600 max-w-md mx-auto">Seg√∫n los datos introducidos, el local no cumple con la normativa m√≠nima de habitabilidad o densidad urban√≠stica.</p>
                    <a href="index.html" class="inline-block mt-8 text-blue-600 font-bold border-b-2 border-blue-600">Volver a inicio</a>
                </div>
            </div>

        </div>
    </div>

    <footer class="p-6 text-center text-gray-400 text-[10px] uppercase tracking-widest">
        ¬© 2026 9US ¬∑ Especialistas en Cambios de Uso
    </footer>

    <script>
        const normasMunicipios = {
            "barcelona": { visor: "https://ajuntament.barcelona.cat/informaciourbanistica/cerca/es/", supMinima: 40, avisoHumos: "üî¥ Nota: Barcelona exige chimenea propia a cubierta.", avisoParking: "‚ÑπÔ∏è Reserva: Barcelona puede exigir plaza de parking." },
            "mataro": { visor: "https://www.mataro.cat/es/temas/urbanismo/planificacion-urbanistica/planeamiento-urbanistico-vigente/planeamiento-urbanistico-vigente", supMinima: 36, avisoHumos: "üî¥ Nota: Suele requerir extracci√≥n a cubierta.", avisoParking: "‚ö†Ô∏è Reserva: Matar√≥ exige vinculaci√≥n de plaza de parking." },
            "general": { visor: "https://dtes.gencat.cat/muc-visor/", supMinima: 36, avisoHumos: "‚ÑπÔ∏è Humos: Se requiere salida a cubierta por normativa CTE.", avisoParking: "‚ÑπÔ∏è Parking: Seg√∫n planeamiento local." }
        };

        // Otros municipios heredan de "general"
        ["lhospitalet", "terrassa", "sabadell"].forEach(m => normasMunicipios[m] = normasMunicipios["general"]);

        let supMinimaActual = 36;
        let densidadValida = false;
        let tecnicaValida = false;

        function actualizarReglasMunicipio() {
            const mun = document.getElementById('municipioSelect').value;
            supMinimaActual = normasMunicipios[mun].supMinima;
            document.getElementById('avisoParking').innerText = normasMunicipios[mun].avisoParking;
            document.getElementById('avisoHumos').innerText = normasMunicipios[mun].avisoHumos;
            document.getElementById('avisosMunicipio').classList.remove('hidden');
        }

        function abrirVisor() { 
            window.open(normasMunicipios[document.getElementById('municipioSelect').value].visor, '_blank'); 
        }

        function calcularDensidad() {
            const p = parseFloat(document.getElementById('superficieParcela').value);
            const i = parseFloat(document.getElementById('indiceDensidad').value);
            const e = parseInt(document.getElementById('viviendasExistentes').value);
            if (!p || !i || isNaN(e)) return;
            const disp = Math.floor(p / i) - e;
            const res = document.getElementById('resultadoDensidad');
            res.classList.remove('hidden');
            if (disp > 0) {
                res.innerHTML = `‚úÖ DENSIDAD DISPONIBLE: Se pueden crear viviendas.`;
                res.className = "mt-2 text-center font-bold text-xs p-2 rounded text-green-700 bg-green-50 border border-green-200";
                densidadValida = true;
            } else {
                res.innerHTML = `‚ùå DENSIDAD AGOTADA: No se permiten m√°s viviendas.`;
                res.className = "mt-2 text-center font-bold text-xs p-2 rounded text-red-700 bg-red-50 border border-red-200";
                densidadValida = false;
            }
        }

        function evaluarTecnico() {
            const sup = parseFloat(document.getElementById('checkSuperficie').value);
            const fac = parseFloat(document.getElementById('checkFachada').value);
            let supOk = false; let facOk = false;

            if (sup) {
                const resSup = document.getElementById('resSuperficie');
                if (sup >= supMinimaActual) { resSup.innerHTML = `‚úÖ Cumple m¬≤ m√≠nimos`; resSup.className = "text-green-600 font-bold text-[10px]"; supOk = true; } 
                else { resSup.innerHTML = `‚ùå M√≠nimo requerido: ${supMinimaActual}m¬≤`; resSup.className = "text-red-600 font-bold text-[10px]"; }
            }
            if (sup && fac) {
                const reqFac = sup / 9;
                const resFac = document.getElementById('resFachada');
                if (fac >= reqFac) { resFac.innerHTML = `‚úÖ Cumple fachada`; resFac.className = "text-green-600 font-bold text-[10px]"; facOk = true; } 
                else { resFac.innerHTML = `‚ùå Insuficiente para esos m¬≤`; resFac.className = "text-red-600 font-bold text-[10px]"; }
            }
            tecnicaValida = (supOk && facOk);
        }

        function irPaso2() {
            if (!densidadValida) { alert("Debes verificar la densidad primero."); return; }
            cambiarPaso(1, 2);
        }

        function irPaso3() {
            const mun = document.getElementById('municipioSelect');
            document.getElementById('hiddenMunicipio').value = mun.options[mun.selectedIndex].text;
            document.getElementById('hiddenSup').value = document.getElementById('checkSuperficie').value + " m2";

            if (tecnicaValida) {
                document.getElementById('resultadoExito').classList.remove('hidden');
                document.getElementById('resultadoFracaso').classList.add('hidden');
            } else {
                document.getElementById('resultadoExito').classList.add('hidden');
                document.getElementById('resultadoFracaso').classList.remove('hidden');
            }
            cambiarPaso(2, 3);
        }

        function volver(destino) { cambiarPaso(destino + 1, destino); }

        function cambiarPaso(actual, destino) {
            document.getElementById(`paso${actual}`).classList.add('hidden');
            document.getElementById(`paso${destino}`).classList.remove('hidden');
            const p = (destino === 1) ? 33 : (destino === 2 ? 66 : 100);
            document.getElementById('progressBar').style.width = `${p}%`;
            for(let i=1; i<=3; i++) {
                let txt = document.getElementById(`progText${i}`);
                if(i <= destino) { txt.classList.remove('text-gray-400'); txt.classList.add('text-blue-600'); }
                else { txt.classList.remove('text-blue-600'); txt.classList.add('text-gray-400'); }
            }
        }
    </script>
</body>
</html>
